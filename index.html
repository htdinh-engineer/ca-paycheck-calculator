<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>California Paycheck & 401(k) Calculator</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <!-- Babel for JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50 min-h-screen py-8 px-4">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const {
        BarChart,
        Bar,
        XAxis,
        YAxis,
        Tooltip,
        Legend,
        ResponsiveContainer,
        LineChart,
        Line,
        CartesianGrid,
      } = Recharts;

      /*
       * Updated tax and benefit calculations.  These functions mirror the
       * progressive tax logic from the provided React component.  Federal
       * and California taxes are computed against real 2025 and 2024 bracket
       * tables, FICA includes additional Medicare tax above the threshold,
       * and CA SDI is a flat rate with no wage cap.  A small set of helper
       * functions are defined up front to encapsulate the progressive tax
       * computation and 401(k) clamping logic.
       */

      // Bracket definitions for 2025 Federal and 2024 CA taxes
      const FED_SINGLE_BRACKETS = [
        { upTo: 11925, rate: 0.10 },
        { upTo: 48475, rate: 0.12 },
        { upTo: 103350, rate: 0.22 },
        { upTo: 197300, rate: 0.24 },
        { upTo: 250525, rate: 0.32 },
        { upTo: 626350, rate: 0.35 },
        { upTo: Infinity, rate: 0.37 },
      ];
      const FED_MFJ_BRACKETS = [
        { upTo: 23850, rate: 0.10 },
        { upTo: 96950, rate: 0.12 },
        { upTo: 206700, rate: 0.22 },
        { upTo: 394600, rate: 0.24 },
        { upTo: 501050, rate: 0.32 },
        { upTo: 751600, rate: 0.35 },
        { upTo: Infinity, rate: 0.37 },
      ];
      const CA_SINGLE_BRACKETS = [
        { upTo: 10756, rate: 0.01 },
        { upTo: 25499, rate: 0.02 },
        { upTo: 40245, rate: 0.04 },
        { upTo: 55866, rate: 0.06 },
        { upTo: 70606, rate: 0.08 },
        { upTo: 360659, rate: 0.093 },
        { upTo: 432787, rate: 0.103 },
        { upTo: 721314, rate: 0.113 },
        { upTo: Infinity, rate: 0.123 },
      ];
      const CA_MFJ_BRACKETS = [
        { upTo: 21512, rate: 0.01 },
        { upTo: 50998, rate: 0.02 },
        { upTo: 80490, rate: 0.04 },
        { upTo: 111732, rate: 0.06 },
        { upTo: 141212, rate: 0.08 },
        { upTo: 721318, rate: 0.093 },
        { upTo: 865574, rate: 0.103 },
        { upTo: 1442628, rate: 0.113 },
        { upTo: Infinity, rate: 0.123 },
      ];

      /**
       * Compute progressive tax given a taxable amount and a bracket table.
       * Taxable income is taxed at each marginal rate up to the limit for
       * that bracket.  If taxable <= 0 the tax is zero.
       */
      function progressiveTax(taxable, brackets) {
        if (taxable <= 0) return 0;
        let tax = 0;
        let lower = 0;
        for (const b of brackets) {
          const upper = Math.min(taxable, b.upTo);
          if (upper > lower) tax += (upper - lower) * b.rate;
          if (taxable <= b.upTo) break;
          lower = b.upTo;
        }
        return tax;
      }

      /**
       * Federal tax calculation based on filing status and taxable income.
       */
      function calcFederalTax(taxable, status) {
        const brackets = status === 'MFJ' ? FED_MFJ_BRACKETS : FED_SINGLE_BRACKETS;
        return progressiveTax(taxable, brackets);
      }

      /**
       * California tax calculation using progressive brackets by filing status.
       */
      function calcCATax(taxable, status) {
        const brackets = status === 'MFJ' ? CA_MFJ_BRACKETS : CA_SINGLE_BRACKETS;
        return progressiveTax(taxable, brackets);
      }

      /**
       * Constants for FICA and SDI.
       */
      const FICA_CONSTANTS = {
        ssRate: 0.062,
        ssWageBase: 176100,
        medicareRate: 0.0145,
        addlMedicareRate: 0.009,
        addlMedicareThreshold: { Single: 200000, MFJ: 250000 },
      };
      const CA_SDI_RATE = 0.012;

      /**
       * Calculate Social Security and Medicare taxes based on gross income and filing status.
       */
      function calcFicaComponents(income, status) {
        // Social Security up to wage base
        const ss = Math.min(income, FICA_CONSTANTS.ssWageBase) * FICA_CONSTANTS.ssRate;
        // Base Medicare 1.45% on all earnings
        const medicareBase = income * FICA_CONSTANTS.medicareRate;
        // Additional Medicare 0.9% above threshold
        const threshold = FICA_CONSTANTS.addlMedicareThreshold[status];
        const addlMed = Math.max(0, income - threshold) * FICA_CONSTANTS.addlMedicareRate;
        return { ss, medicare: medicareBase + addlMed };
      }

      /**
       * California SDI: simple percentage of wages, no cap.
       */
      function calcCASDI(income) {
        return income * CA_SDI_RATE;
      }

      /**
       * Clamp employee 401(k) contributions against the IRS limit (and optional catch‑up).
       */
      function clamp401k(empPct, salary, limit, catchup) {
        const desired = empPct * salary;
        const cap = limit + catchup;
        return Math.min(Math.max(0, desired), cap);
      }

      function App() {
        const [status, setStatus] = useState('MFJ');
        const [salary, setSalary] = useState(100000);
        const [payFreq, setPayFreq] = useState('weekly');
        const [percent401k, setPercent401k] = useState(6);
        const [matchRate, setMatchRate] = useState(0.5);
        const [matchCap, setMatchCap] = useState(6);
        const [raise, setRaise] = useState(3);
        const [years, setYears] = useState(30);
        const [returnRate, setReturnRate] = useState(7);
        const [discountRate, setDiscountRate] = useState(4);
        const [federalDeduct, setFederalDeduct] = useState(status === 'MFJ' ? 30000 : 15000);
        const [caDeduct, setCaDeduct] = useState(status === 'MFJ' ? 11080 : 5540);
        const [limit401k, setLimit401k] = useState(23000);

        useEffect(() => {
          setFederalDeduct(status === 'MFJ' ? 30000 : 15000);
          setCaDeduct(status === 'MFJ' ? 11080 : 5540);
        }, [status]);

        function computeCurrent() {
          const income = salary;
          // Convert 401(k) percentage to decimal
          const empPct = percent401k / 100;
          // Clamp 401(k) contributions to the annual limit (catch‑up is zero by default)
          const employee401k = clamp401k(empPct, income, limit401k, 0);
          // Compute taxable income after standard deduction and 401(k) contributions
          const taxableFed = Math.max(0, income - federalDeduct - employee401k);
          const taxableCA = Math.max(0, income - caDeduct - employee401k);
          // Compute taxes
          const fedTax = calcFederalTax(taxableFed, status);
          const caTax = calcCATax(taxableCA, status);
          // Compute FICA components (SS + Medicare + additional Medicare) and sum to one figure
          const { ss, medicare } = calcFicaComponents(income, status);
          const fica = ss + medicare;
          // California SDI is a separate deduction
          const casdi = calcCASDI(income);
          // Employer match: matchRate for each dollar up to matchCap percent of salary
          const match = income * Math.min(empPct, matchCap / 100) * matchRate;
          // Take‑home pay after all deductions and employee 401(k)
          const takeHome = income - fedTax - fica - caTax - casdi - employee401k;
          return {
            employee401k,
            match,
            fedTax,
            caTax,
            fica,
            casdi,
            takeHome,
          };
        }

        function computeProjection() {
          const yrs = parseInt(years, 10);
          const raiseRate = raise / 100;
          const empPct = percent401k / 100;
          const mRate = matchRate;
          const mCapPct = matchCap / 100;
          const expReturn = returnRate / 100;
          const disc = discountRate / 100;
          let currSalary = salary;
          const data = [];
          let totalEmployee = 0;
          let totalMatch = 0;
          let futureValue = 0;
          let presentValue = 0;
          for (let i = 0; i < yrs; i++) {
            // Employee contribution for this year, clamped against the 401(k) limit (no catch‑up in projection)
            const employee = clamp401k(empPct, currSalary, limit401k, 0);
            // Employer match: matchRate per dollar up to mCapPct of salary
            const match = currSalary * Math.min(empPct, mCapPct) * mRate;
            totalEmployee += employee;
            totalMatch += match;
            // Future value: each year's contributions grow until the end of the projection
            const fvEmployee = employee * Math.pow(1 + expReturn, yrs - i - 1);
            const fvMatch = match * Math.pow(1 + expReturn, yrs - i - 1);
            futureValue += fvEmployee + fvMatch;
            // Present value: discount contributions back to today (i+1 years from now)
            const pvEmployee = employee / Math.pow(1 + disc, i + 1);
            const pvMatch = match / Math.pow(1 + disc, i + 1);
            presentValue += pvEmployee + pvMatch;
            // Compute take‑home for this year with current salary and contribution
            const taxableFed = Math.max(0, currSalary - federalDeduct - employee);
            const taxableCA = Math.max(0, currSalary - caDeduct - employee);
            const fedTax = calcFederalTax(taxableFed, status);
            const caTax = calcCATax(taxableCA, status);
            const { ss, medicare } = calcFicaComponents(currSalary, status);
            const fica = ss + medicare;
            const casdi = calcCASDI(currSalary);
            const takeHome = currSalary - fedTax - fica - caTax - casdi - employee;
            data.push({
              year: i + 1,
              salary: currSalary,
              employee,
              match,
              total: employee + match,
              cumulative: totalEmployee + totalMatch,
              takeHome: takeHome,
            });
            // Apply raise to salary for next year
            currSalary = currSalary * (1 + raiseRate);
          }
          return { data, totalEmployee, totalMatch, futureValue, presentValue };
        }

        const current = computeCurrent();
        const proj = computeProjection();

        const payPeriods = {
          weekly: 52,
          biweekly: 26,
          semimonthly: 24,
          monthly: 12,
          yearly: 1,
        };
        const periods = payPeriods[payFreq] || 52;
        const periodTakeHome = current.takeHome / periods;

        const breakdownData = [
          {
            name: 'Annual',
            'Take-Home': current.takeHome,
            Federal: current.fedTax,
            'FICA (SS+Med)': current.fica,
            'CA Income Tax': current.caTax,
            'CA SDI': current.casdi,
            'Employee 401(k)': current.employee401k,
          },
        ];

        return (
          <div className="max-w-4xl mx-auto">
            <h1 className="text-3xl font-bold mb-4 text-center">CA Paycheck & 401(k) Planner</h1>
            <div className="bg-white shadow rounded-lg p-4 mb-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium">Filing Status</label>
                  <select
                    value={status}
                    onChange={(e) => setStatus(e.target.value)}
                    className="mt-1 p-2 border rounded w-full"
                  >
                    <option value="MFJ">Married Filing Jointly</option>
                    <option value="Single">Single</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium">Annual Salary ($)</label>
                  <input
                    type="number"
                    value={salary}
                    onChange={(e) => setSalary(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Pay Frequency</label>
                  <select
                    value={payFreq}
                    onChange={(e) => setPayFreq(e.target.value)}
                    className="mt-1 p-2 border rounded w-full"
                  >
                    <option value="weekly">Weekly</option>
                    <option value="biweekly">Biweekly</option>
                    <option value="semimonthly">Semi-Monthly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium">401(k) % (of salary)</label>
                  <input
                    type="number"
                    value={percent401k}
                    min="0"
                    max="100"
                    onChange={(e) => setPercent401k(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Company Match (per $)</label>
                  <input
                    type="number"
                    value={matchRate}
                    min="0"
                    max="1"
                    step="0.01"
                    onChange={(e) => setMatchRate(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Match up to % of salary</label>
                  <input
                    type="number"
                    value={matchCap}
                    min="0"
                    max="100"
                    onChange={(e) => setMatchCap(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Annual Salary Raise %</label>
                  <input
                    type="number"
                    value={raise}
                    min="0"
                    max="100"
                    step="0.1"
                    onChange={(e) => setRaise(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Years to Project</label>
                  <input
                    type="number"
                    value={years}
                    min="1"
                    max="50"
                    onChange={(e) => setYears(parseInt(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Expected Return %</label>
                  <input
                    type="number"
                    value={returnRate}
                    min="0"
                    max="100"
                    step="0.1"
                    onChange={(e) => setReturnRate(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium">Discount Rate % (for PV)</label>
                  <input
                    type="number"
                    value={discountRate}
                    min="0"
                    max="100"
                    step="0.1"
                    onChange={(e) => setDiscountRate(parseFloat(e.target.value) || 0)}
                    className="mt-1 p-2 border rounded w-full"
                  />
                </div>
              </div>
              <details className="mt-4">
                <summary className="cursor-pointer font-semibold">Advanced settings</summary>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                  <div>
                    <label className="block text-sm font-medium">Federal Standard Deduction ($)</label>
                    <input
                      type="number"
                      value={federalDeduct}
                      min="0"
                      onChange={(e) => setFederalDeduct(parseFloat(e.target.value) || 0)}
                      className="mt-1 p-2 border rounded w-full"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium">CA Standard Deduction ($)</label>
                    <input
                      type="number"
                      value={caDeduct}
                      min="0"
                      onChange={(e) => setCaDeduct(parseFloat(e.target.value) || 0)}
                      className="mt-1 p-2 border rounded w-full"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium">401(k) Contribution Limit ($)</label>
                    <input
                      type="number"
                      value={limit401k}
                      min="0"
                      onChange={(e) => setLimit401k(parseFloat(e.target.value) || 0)}
                      className="mt-1 p-2 border rounded w-full"
                    />
                  </div>
                </div>
              </details>
            </div>
            <div className="bg-white shadow rounded-lg p-4 mb-6">
              <h2 className="text-xl font-semibold mb-2">Current Take‑Home</h2>
              <p className="mb-2">
                Annual take‑home: <strong>${(current.takeHome).toFixed(0)}</strong>, per-
                {payFreq}: <strong>${(periodTakeHome).toFixed(0)}</strong>
              </p>
              <div style={{ width: '100%', height: 300 }}>
                <ResponsiveContainer>
                  <BarChart data={breakdownData} margin={{ top: 20, right: 30, left: 0, bottom: 5 }}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="name" />
                    <YAxis />
                    <Tooltip formatter={(value) => `$${value.toFixed(0)}`} />
                    <Legend />
                    <Bar dataKey="Employee 401(k)" stackId="a" fill="#6366F1" />
                    <Bar dataKey="Federal" stackId="a" fill="#22C55E" />
                    <Bar dataKey="FICA (SS+Med)" stackId="a" fill="#06B6D4" />
                    <Bar dataKey="CA Income Tax" stackId="a" fill="#F59E0B" />
                    <Bar dataKey="CA SDI" stackId="a" fill="#EF4444" />
                    <Bar dataKey="Take-Home" stackId="a" fill="#A78BFA" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </div>
            <div className="bg-white shadow rounded-lg p-4 mb-6">
              <h2 className="text-xl font-semibold mb-2">Projection</h2>
              <p className="mb-2">
                Total contributions (employee + match):{' '}
                <strong>${(proj.totalEmployee + proj.totalMatch).toFixed(0)}</strong> | Future value:{' '}
                <strong>${(proj.futureValue).toFixed(0)}</strong> | Present value:{' '}
                <strong>${(proj.presentValue).toFixed(0)}</strong>
              </p>
              <div style={{ width: '100%', height: 300 }}>
                <ResponsiveContainer>
                  <LineChart data={proj.data} margin={{ top: 20, right: 30, left: 0, bottom: 5 }}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="year" />
                    <YAxis />
                    <Tooltip
                      formatter={(value) => `$${value.toFixed(0)}`}
                      labelFormatter={(label) => `Year ${label}`}
                    />
                    <Legend />
                    <Line type="monotone" dataKey="employee" name="Employee" />
                    <Line type="monotone" dataKey="match" name="Employer Match" />
                    <Line type="monotone" dataKey="cumulative" name="Cumulative" />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>
            <footer className="text-center text-sm text-gray-500">
              <p>
                This calculator provides illustrative estimates only and does not constitute tax or financial advice.
              </p>
            </footer>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>